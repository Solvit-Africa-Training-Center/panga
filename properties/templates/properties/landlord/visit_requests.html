{% load static %}
<!DOCTYPE html>
<html class="dark" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>GUKODESHA - My Visit Requests</title>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
              rel="stylesheet" />
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
              rel="stylesheet" />
        <script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#38e07b",
                    "background-dark": "#122017",
                    "surface-dark": "#1a2c22",
                    "border-dark": "#29382f",
                    "text-secondary": "#9eb7a8"
                },
                fontFamily: {
                    "display": ["Manrope", "sans-serif"],
                    "body": ["Noto Sans", "sans-serif"]
                },
            },
        },
    }
        </script>
    </head>
    <body class="bg-background-dark text-white font-display antialiased">
        <div class="flex h-screen w-full flex-col overflow-hidden">
            {% include 'partial/header.html' %}
            <div class="flex flex-1 overflow-hidden">
                <main class="flex-1 overflow-y-auto bg-[#0d1410]">
                    <div class="mx-auto max-w-6xl px-6 py-8 md:px-12 md:py-12">
                        <!-- Header -->
                        <div class="mb-10">
                            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-2">My property(ies) Visit Requests</h1>
                            <p class="text-text-secondary text-lg">Track your properties visit requests</p>
                        </div>
                        <!-- Messages -->
                        {% if messages %}
                            <div class="mb-6 space-y-3">
                                {% for message in messages %}
                                    <div class="flex items-center gap-3 p-4 rounded-xl border {% if message.tags == 'success' %}bg-primary/10 border-primary{% elif message.tags == 'error' %}bg-red-500/10 border-red-500{% elif message.tags == 'warning' %}bg-orange-500/10 border-orange-500{% endif %}">
                                        <span class="material-symbols-outlined">
                                            {% if message.tags == 'success' %}
                                                check_circle
                                            {% elif message.tags == 'error' %}
                                                error
                                            {% else %}
                                                warning
                                            {% endif %}
                                        </span>
                                        <p class="text-sm font-medium">{{ message }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <!-- Visit Requests List -->
                        {% if visit_requests %}
                            <div class="space-y-4">
                                {% for visit_request in visit_requests %}
                                    <div class="bg-surface-dark border border-border-dark rounded-xl overflow-hidden hover:border-primary/50 transition-all">
                                        <div class="p-6">
                                            <div class="flex flex-col md:flex-row gap-6">
                                                <!-- Image -->
                                                <div class="w-full md:w-48 aspect-video md:aspect-square bg-gray-800 rounded-lg overflow-hidden flex-shrink-0">
                                                    {% if visit_request.house.main_image %}
                                                        <img src="{{ visit_request.house.main_image.url }}"
                                                             alt="{{ visit_request.house.label }}"
                                                             class="w-full h-full object-cover">
                                                    {% else %}
                                                        <div class="w-full h-full flex items-center justify-center">
                                                            <span class="material-symbols-outlined text-4xl text-text-secondary">home</span>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                                <!-- Details -->
                                                <div class="flex-1">
                                                    <div class="flex items-start justify-between mb-3">
                                                        <div>
                                                            <h3 class="text-xl font-bold text-white mb-1">{{ visit_request.house.label|default:visit_request.house.type }}</h3>
                                                            <p class="text-text-secondary text-sm flex items-center gap-1 mb-2">
                                                                <span class="material-symbols-outlined text-base">pin_drop</span>
                                                                {{ visit_request.house.location.name }}, {{ visit_request.house.location.cell.sector.district.city.name }}
                                                            </p>
                                                        </div>
                                                        <div class="text-right">
                                                            <p class="text-2xl font-bold text-primary">{{ visit_request.house.monthly_rent|floatformat:0 }} FR</p>
                                                            <p class="text-xs text-text-secondary">per month</p>
                                                        </div>
                                                    </div>
                                                    <!-- Visit Request Info -->
                                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                                        <div class="bg-[#122017] border border-border-dark rounded-lg p-3">
                                                            <p class="text-xs text-text-secondary mb-1">Visit Date</p>
                                                            <p class="text-sm font-bold text-white">{{ visit_request.visit_date|date:"M d, Y" }}</p>
                                                        </div>
                                                        <div class="bg-[#122017] border border-border-dark rounded-lg p-3">
                                                            <p class="text-xs text-text-secondary mb-1">Guests</p>
                                                            <p class="text-sm font-bold text-white">{{ visit_request.guests }} guest{{ visit_request.guests|pluralize }}</p>
                                                        </div>
                                                        <div class="bg-[#122017] border border-border-dark rounded-lg p-3">
                                                            <p class="text-xs text-text-secondary mb-1">Submitted</p>
                                                            <p class="text-sm font-bold text-white">{{ visit_request.created_at|date:"M d, Y" }}</p>
                                                        </div>
                                                        <div class="bg-[#122017] border border-border-dark rounded-lg p-3">
                                                            <p class="text-xs text-text-secondary mb-1">Status</p>
                                                            <p class="text-sm font-bold text-blue-400">Pending</p>
                                                        </div>
                                                    </div>
                                                    <!-- Message if provided -->
                                                    {% if visit_request.message %}
                                                        <div class="bg-[#122017] border border-border-dark rounded-lg p-4 mb-4">
                                                            <p class="text-xs text-text-secondary mb-2">Your Message:</p>
                                                            <p class="text-sm text-white">{{ visit_request.message }}</p>
                                                        </div>
                                                    {% endif %}
                                                    <!-- Actions -->
                                                    <div class="flex gap-3">
                                                        <a href="{% url 'house_detail' visit_request.house.id %}"
                                                           class="flex-1 bg-border-dark hover:bg-primary/20 text-white hover:text-primary border border-transparent hover:border-primary/30 rounded-lg px-4 py-2 text-sm font-bold transition-all flex items-center justify-center gap-2">
                                                            <span class="material-symbols-outlined text-base">visibility</span>
                                                            View Property
                                                        </a>
                                                        <button onclick="confirmCancel({{ visit_request.id }}, 'visit', '{{ visit_request.house.label|default:visit_request.house.type }}')"
                                                                class="flex-1 bg-red-500/10 hover:bg-red-500 text-red-400 hover:text-white border border-red-500/30 hover:border-red-500 rounded-lg px-4 py-2 text-sm font-bold transition-all flex items-center justify-center gap-2">
                                                            <span class="material-symbols-outlined text-base">cancel</span>
                                                            Cancel
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-20">
                                <span class="material-symbols-outlined text-6xl text-text-secondary mb-4 block">calendar_month</span>
                                <h3 class="text-xl font-bold text-white mb-2">No Visit Requests Yet</h3>
                                <p class="text-text-secondary mb-6">Come back later when users will have made reservations on your properties</p>
                                <a href="{% url 'landlord_properties' %}"
                                   class="inline-flex items-center gap-2 bg-primary hover:bg-primary/90 text-background-dark rounded-lg px-6 py-3 font-bold transition-all">
                                    <span class="material-symbols-outlined">search</span>
                                    Browse Properties
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </main>
            </div>
        </div>
        <!-- Cancel Confirmation Modal -->
        <div id="cancelModal"
             class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-surface-dark border border-border-dark rounded-2xl max-w-md w-full p-6 transform scale-95 opacity-0 transition-all duration-200"
                 id="cancelModalContent">
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0">
                        <span class="material-symbols-outlined text-red-500 text-2xl">warning</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-white mb-1">
                            Cancel <span id="cancelType"></span>
                        </h3>
                        <p class="text-text-secondary text-sm">
                            Are you sure you want to cancel your <span id="cancelTypeLower"></span> for <span id="propertyName" class="text-white font-semibold"></span>? This action cannot be undone.
                        </p>
                    </div>
                </div>
                <form id="cancelForm" method="POST" class="flex gap-3 mt-6">
                    {% csrf_token %}
                    <button type="button"
                            onclick="closeCancelModal()"
                            class="flex-1 bg-border-dark hover:bg-border-dark/80 text-white rounded-lg px-4 py-2.5 font-bold transition-all">
                        Keep It
                    </button>
                    <button type="submit"
                            class="flex-1 bg-red-500 hover:bg-red-600 text-white rounded-lg px-4 py-2.5 font-bold transition-all">
                        Yes, Cancel
                    </button>
                </form>
            </div>
        </div>
        <script>
    function confirmCancel(id, type, propertyName) {
        const modal = document.getElementById('cancelModal');
        const form = document.getElementById('cancelForm');
        const nameSpan = document.getElementById('propertyName');
        const typeSpan = document.getElementById('cancelType');
        const typeLowerSpan = document.getElementById('cancelTypeLower');
        const content = document.getElementById('cancelModalContent');
        
        nameSpan.textContent = propertyName;
        typeSpan.textContent = type === 'visit' ? 'Visit Request' : 'Reservation';
        typeLowerSpan.textContent = type === 'visit' ? 'visit request' : 'reservation';
        form.action = type === 'visit' ? `/cancel-visit-request/${id}/` : `/cancel-reservation/${id}/`;
        
        modal.classList.remove('hidden');
        setTimeout(() => {
            content.classList.remove('scale-95', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
        }, 10);
    }

    function closeCancelModal() {
        const modal = document.getElementById('cancelModal');
        const content = document.getElementById('cancelModalContent');
        
        content.classList.add('scale-95', 'opacity-0');
        content.classList.remove('scale-100', 'opacity-100');
        
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 200);
    }

    document.getElementById('cancelModal').addEventListener('click', function(e) {
        if (e.target === this) closeCancelModal();
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeCancelModal();
    });
        </script>
    </body>
</html>
