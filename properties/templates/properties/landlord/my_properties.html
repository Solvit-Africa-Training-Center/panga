{% load static %}
<!DOCTYPE html>
<html class="dark" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>GUKODESHA - My Properties</title>
        <!-- Fonts -->
        <link href="https://fonts.googleapis.com" rel="preconnect" />
        <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&amp;display=swap"
              rel="stylesheet" />
        <!-- Material Symbols -->
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
              rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
              rel="stylesheet" />
        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <!-- Tailwind Config -->
        <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#38e07b",
                        "background-light": "#f6f8f7",
                        "background-dark": "#122017",
                        "surface-dark": "#1c2e24", 
                        "border-dark": "#29382f",
                        "text-secondary": "#9eb7a8"
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "2xl": "1rem", "full": "9999px"},
                },
            },
        }
        </script>
        <style>
        body {
            font-family: 'Manrope', sans-serif;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .material-symbols-filled {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        </style>
    </head>
    <body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white overflow-hidden h-screen flex w-full">
        <!-- Sidebar -->
        <aside class="hidden md:flex flex-col w-64 h-full border-r border-border-dark bg-background-dark flex-shrink-0">
            <div class="p-6 flex items-center gap-3">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                     data-alt="Abstract geometric logo in green shades"
                     style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBcUJX1beEcp80XEBBqZiz_k_5wtT5omea2crmPzkXk4hKuq6scJ9oWL-mA31bPh381gubOy7vfc0ZngHPkE18RG_JIYPgvPShcf-vs9bMcD5UmF5faCt3p51CeEHAeJxHfrdEttP2OjM2KD4IeJjXMKLNCYgItMwQGB9J7SmL0hcHexE9nOkFbc0VE2sm7nl0Z49Cf88V5JUj2pCK-CsENhF96giaWNUEM8IiTaqe2mlU2RRI1-2gNSTbH3C8CWj5iv8l8FhVYeeo")'>
                </div>
                <div class="flex flex-col">
                    <h1 class="text-white text-lg font-bold leading-tight tracking-tight">GUKODESHA</h1>
                    <p class="text-text-secondary text-xs font-medium">Landlord Portal</p>
                </div>
            </div>
            <nav class="flex-1 overflow-y-auto px-4 py-2 flex flex-col gap-2">
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg text-text-secondary hover:bg-surface-dark hover:text-white transition-colors group"
                   href="#">
                    <span class="material-symbols-outlined text-text-secondary group-hover:text-white">dashboard</span>
                    <span class="text-sm font-medium">Dashboard</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg bg-primary/20 text-primary transition-colors"
                   href="#">
                    <span class="material-symbols-filled text-primary">real_estate_agent</span>
                    <span class="text-sm font-bold">Properties</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg text-text-secondary hover:bg-surface-dark hover:text-white transition-colors group"
                   href="#">
                    <span class="material-symbols-outlined text-text-secondary group-hover:text-white">groups</span>
                    <span class="text-sm font-medium">Tenants</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg text-text-secondary hover:bg-surface-dark hover:text-white transition-colors group"
                   href="#">
                    <span class="material-symbols-outlined text-text-secondary group-hover:text-white">payments</span>
                    <span class="text-sm font-medium">Payments</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg text-text-secondary hover:bg-surface-dark hover:text-white transition-colors group"
                   href="#">
                    <span class="material-symbols-outlined text-text-secondary group-hover:text-white">handyman</span>
                    <span class="text-sm font-medium">Maintenance</span>
                </a>
            </nav>
            <div class="p-4 border-t border-border-dark mt-auto">
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg text-text-secondary hover:bg-surface-dark hover:text-white transition-colors group"
                   href="#">
                    <span class="material-symbols-outlined text-text-secondary group-hover:text-white">settings</span>
                    <span class="text-sm font-medium">Settings</span>
                </a>
                <a class="flex items-center gap-3 px-3 py-3 rounded-lg text-text-secondary hover:bg-surface-dark hover:text-white transition-colors group"
                   href="{% url 'login' %}">
                    <span class="material-symbols-outlined text-text-secondary group-hover:text-white">logout</span>
                    <span class="text-sm font-medium">Log Out</span>
                </a>
            </div>
        </aside>
        <!-- Main Content -->
        <main class="flex-1 flex flex-col h-full overflow-hidden bg-background-dark relative">
            <!-- Top Nav -->
            <header class="flex items-center justify-between border-b border-border-dark px-6 py-4 bg-background-dark z-20">
                <div class="flex items-center gap-4 text-white md:hidden">
                    <button class="p-1 rounded-md hover:bg-surface-dark">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                    <span class="font-bold">GUKODESHA</span>
                </div>
                <!-- Breadcrumbs / Page Title for Mobile -->
                <div class="hidden md:flex items-center gap-2 text-text-secondary text-sm">
                    <span>Landlord Portal</span>
                    <span class="material-symbols-outlined text-[16px]">chevron_right</span>
                    <span class="text-white font-medium">My Properties</span>
                </div>
                <div class="flex flex-1 justify-end gap-6 items-center">
                    <div class="flex gap-2">
                        <button class="flex size-10 items-center justify-center rounded-lg bg-surface-dark text-white hover:bg-border-dark transition-colors relative">
                            <span class="material-symbols-outlined">notifications</span>
                            <span class="absolute top-2 right-2 size-2 bg-primary rounded-full"></span>
                        </button>
                        <button class="flex size-10 items-center justify-center rounded-lg bg-surface-dark text-white hover:bg-border-dark transition-colors">
                            <span class="material-symbols-outlined">help</span>
                        </button>
                    </div>
                    <div class="flex items-center gap-3 pl-6 border-l border-border-dark">
                        <div class="text-right hidden sm:block">
                            <p class="text-sm font-bold text-white leading-none">{{ user.first_name|capfirst }}</p>
                            <p class="text-xs text-text-secondary mt-1">Property Owner</p>
                        </div>
                        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 ring-2 ring-surface-dark"
                             data-alt="Portrait of a landlord smiling"
                             style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBqi5LObN_0fWb4OoBRaZ3Q2GTlokmIQAVkIrW805izpZb0FJrlM9Zh1FH2unc2ovopL5TuPH41kLxLga2TzkkMCwseagYM94UDPEwyvJrwvyHk0UIdDmDmqQfjKTsUnbPvB-sC5a1jneBHs6IE_EO_9GGu7n1pWsioBEfGq9Jr8TwFThlnN0KU_-3oFslxWAe2eDf8UpdDAtQ-0X9c9JFvkYzg-rqGs8q4fMahWX6PA0jBn8RtAsMUCH5EHCuuXTT5VAULKNnTEQU")'>
                        </div>
                    </div>
                </div>
            </header>
            <!-- Scrollable Content Area -->
            <div class="flex-1 overflow-y-auto no-scrollbar p-6 lg:p-10">
                <div class="max-w-[1200px] mx-auto flex flex-col gap-8">
                    <!-- Page Heading & Actions -->
                    <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
                        <div class="flex flex-col gap-2">
                            <h2 class="text-white text-3xl lg:text-4xl font-extrabold tracking-tight">My Properties</h2>
                            <p class="text-text-secondary text-base lg:text-lg">
                                Manage your portfolio, update availability, and track revenue across the Great Lakes region.
                            </p>
                        </div>
                        <a href = "{% url 'house_create' %}">
                        <button class="flex items-center justify-center gap-2 bg-primary text-background-dark hover:bg-opacity-90 transition-all font-bold text-sm px-6 py-3 rounded-lg shadow-lg shadow-primary/20 whitespace-nowrap">
                            <span class="material-symbols-outlined">add</span>
                            <span>Add New Property</span>
                        </button> </a>
                    </div>
                    
                    <!-- Stats Section -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="flex flex-col gap-3 rounded-xl p-6 bg-surface-dark border border-border-dark">
        <div class="flex items-center justify-between">
            <p class="text-text-secondary font-medium">Total Properties</p>
            <span class="material-symbols-outlined text-primary">domain</span>
        </div>
        <div class="flex items-end gap-3">
            <p class="text-white text-3xl font-bold leading-none">{{ total_properties }}</p>
        </div>
    </div>
    
    <div class="flex flex-col gap-3 rounded-xl p-6 bg-surface-dark border border-border-dark">
        <div class="flex items-center justify-between">
            <p class="text-text-secondary font-medium">Vacant Units</p>
            <span class="material-symbols-outlined text-yellow-500">key_off</span>
        </div>
        <div class="flex items-end gap-3">
            <p class="text-white text-3xl font-bold leading-none">{{ vacant_units }}</p>
            {% if total_properties > 0 %}
            <p class="text-text-secondary text-sm font-medium">{{ vacancy_rate|floatformat:1 }}% vacancy rate</p>
            {% endif %}
        </div>
    </div>
    
    <div class="flex flex-col gap-3 rounded-xl p-6 bg-surface-dark border border-border-dark">
        <div class="flex items-center justify-between">
            <p class="text-text-secondary font-medium">Monthly Revenue</p>
            <span class="material-symbols-outlined text-primary">attach_money</span>
        </div>
        <div class="flex items-end gap-3">
            <p class="text-white text-3xl font-bold leading-none">{{ total_revenue|floatformat:0 }} RWF</p>
        </div>
    </div>
</div>
                    <!-- Filters & Search -->
                    <div class="flex flex-col lg:flex-row gap-4">
                        <label class="flex-1 relative group">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                <span class="material-symbols-outlined text-text-secondary group-focus-within:text-white transition-colors">search</span>
                            </div>
                            <input class="w-full bg-surface-dark border border-border-dark text-white text-sm rounded-lg focus:ring-primary focus:border-primary block pl-11 p-3.5 placeholder-text-secondary transition-colors"
                                   placeholder="Search properties by name, location, or price..."
                                   type="text" />
                        </label>
                        <div class="flex gap-3 overflow-x-auto pb-2 lg:pb-0 no-scrollbar">
                            <div class="relative min-w-[140px]">
                                <select class="w-full bg-surface-dark border border-border-dark text-white text-sm rounded-lg focus:ring-primary focus:border-primary block p-3.5 appearance-none cursor-pointer">
                                    <option value="Choose house status" disabled selected>Select Status</option>
                                    <option value="Available">Available</option>
                                    <option value="Rented">Rented</option>
                                    <option value="Under Maintenance">Under Maintenance</option>
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="material-symbols-outlined text-text-secondary">expand_more</span>
                                </div>
                            </div>
                            <div class="relative min-w-[140px]">
                                <select class="w-full bg-surface-dark border border-border-dark text-white text-sm rounded-lg focus:ring-primary focus:border-primary block p-3.5 appearance-none cursor-pointer">
                                    <option value="" disabled selected>Select location</option>
                                    {% for district in districts %}
                                    <option value="{{district.id}}">{{district.name}} </option>
                                    {% endfor %}
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                    <span class="material-symbols-outlined text-text-secondary">expand_more</span>
                                </div>
                            </div>
                            <button class="flex items-center justify-center gap-2 bg-surface-dark text-white border border-border-dark hover:bg-border-dark transition-all font-bold text-sm px-4 py-3 rounded-lg whitespace-nowrap">
                                <span class="material-symbols-outlined">tune</span>
                                <span>More Filters</span>
                            </button>
                        </div>
                    </div>
                    <!-- Property Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 pb-10">
                        {% for house in houses %}
                        <!-- Property Card -->
                        <div class="group flex flex-col bg-surface-dark rounded-xl overflow-hidden border border-border-dark hover:border-primary/50 transition-all duration-300 hover:shadow-xl hover:shadow-black/20">
                            <div class="relative h-56 overflow-hidden">
                                <!-- Status Badge -->
                                <div class="absolute top-4 left-4 z-10 
                                    {% if house.status == 'Available' %}bg-primary/90 text-background-dark
                                    {% elif house.status == 'Rented' %}bg-black/60 text-white
                                    {% else %}bg-gray-700/90 text-white{% endif %} 
                                    backdrop-blur-md text-xs font-bold px-3 py-1.5 rounded-md flex items-center gap-1">
                                    {% if house.status == 'Rented' %}
                                        <span class="size-2 rounded-full bg-primary animate-pulse"></span>
                                    {% elif house.status == 'Under Maintenance' %}
                                        <span class="material-symbols-outlined text-[14px]">build</span>
                                    {% endif %}
                                    {{ house.status|upper }}
                                </div>
                                
                                <!-- Options Menu -->
                                <div class="absolute top-4 right-4 z-10">
                                    <button class="bg-black/40 hover:bg-black/70 backdrop-blur-md text-white rounded-full p-1.5 transition-colors">
                                        <span class="material-symbols-outlined text-[20px]">more_horiz</span>
                                    </button>
                                </div>
                                
                                <!-- House Image -->
                                {% if house.main_image %}
                                    <div class="bg-cover bg-center w-full h-full group-hover:scale-105 transition-transform duration-500 
                                        {% if house.status == 'Under Maintenance' %}grayscale group-hover:grayscale-0{% endif %}"
                                         style='background-image: url("{{ house.main_image.url }}");'>
                                    </div>
                                {% else %}
                                    <div class="bg-surface-dark w-full h-full flex items-center justify-center">
                                        <span class="material-symbols-outlined text-text-secondary text-6xl">home</span>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="p-5 flex flex-col gap-4 flex-1">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="text-xl font-bold text-white group-hover:text-primary transition-colors">
                                            {{ house.label|default:"Untitled Property" }}
                                        </h3>
                                        <div class="flex items-center gap-1 text-text-secondary text-sm mt-1">
                                            <span class="material-symbols-outlined text-[16px]">location_on</span>
                                            <span>{{ house.location.name }}, {{ house.location.cell.sector.district.name }}</span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-lg font-bold text-white">{{ house.monthly_rent|floatformat:0 }} RWF</p>
                                        <p class="text-xs text-text-secondary">/month</p>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-3 gap-2 py-3 border-y border-border-dark">
                                    <div class="flex flex-col items-center justify-center p-1">
                                        <span class="text-white font-bold text-lg">{{ house.n_bed_rooms }}</span>
                                        <span class="text-xs text-text-secondary uppercase tracking-wider">Bed{% if house.n_bed_rooms != 1 %}s{% endif %}</span>
                                    </div>
                                    <div class="flex flex-col items-center justify-center border-l border-border-dark p-1">
                                        <span class="text-white font-bold text-lg">{{ house.n_bath_rooms }}</span>
                                        <span class="text-xs text-text-secondary uppercase tracking-wider">Bath{% if house.n_bath_rooms != 1 %}s{% endif %}</span>
                                    </div>
                                    <div class="flex flex-col items-center justify-center border-l border-border-dark p-1">
                                        <span class="text-white font-bold text-lg">{{ house.surface }}</span>
                                        <span class="text-xs text-text-secondary uppercase tracking-wider">m<sup>2</sup></span>
                                    </div>
                                </div>
                                
                                <div class="mt-auto pt-2 flex gap-2">
                                    <a href="{% url 'house_detail' house.id %}" class="flex-1 py-2.5 rounded-lg border border-border-dark text-white font-semibold text-sm hover:bg-border-dark hover:border-text-secondary/30 transition-all flex items-center justify-center gap-2">
                                        <span>View Details</span>
                                        <span class="material-symbols-outlined text-[18px]">arrow_forward</span>
                                    </a>
                                    <a href="" class="px-3 py-2.5 rounded-lg border border-border-dark text-white hover:bg-border-dark transition-all">
                                        <span class="material-symbols-outlined">edit</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <!-- Empty State -->
                        <div class="col-span-full flex flex-col items-center justify-center py-16">
                            <span class="material-symbols-outlined text-text-secondary text-8xl mb-4">home_work</span>
                            <h3 class="text-2xl font-bold text-white mb-2">No Properties Listed Yet</h3>
                            <p class="text-text-secondary text-center mb-6">Start building your portfolio by adding your first property.</p>
                            <a href="{% url 'house_create' %}">
                                <button class="flex items-center justify-center gap-2 bg-primary text-background-dark hover:bg-opacity-90 transition-all font-bold text-sm px-6 py-3 rounded-lg shadow-lg shadow-primary/20">
                                    <span class="material-symbols-outlined">add</span>
                                    <span>Add New Property</span>
                                </button>
                            </a>
                        </div>
                        {% endfor %}
                        
                     
                        
                       
                        <!-- Card 6: Add New Placeholder -->
                        <div class="group flex flex-col items-center justify-center bg-transparent rounded-xl overflow-hidden border-2 border-dashed border-border-dark hover:border-primary/50 hover:bg-surface-dark/50 transition-all duration-300 min-h-[400px] cursor-pointer">
                            <div class="size-16 rounded-full bg-surface-dark flex items-center justify-center mb-4 group-hover:bg-primary group-hover:text-background-dark transition-colors text-text-secondary">
                                <span class="material-symbols-outlined text-3xl">add</span>
                            </div> <a href = "{% url 'house_create' %}"
                            <h3 class="text-xl font-bold text-white mb-2">Add New Property</h3></a>
                            <p class="text-text-secondary text-center px-8 text-sm">Expand your portfolio by listing a new house or apartment.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </body>
</html>
