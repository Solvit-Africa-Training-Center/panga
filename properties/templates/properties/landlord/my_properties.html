{% load static %}
<!DOCTYPE html>
<html class="dark" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>GUKODESHA - My Properties</title>
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
              rel="stylesheet" />
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap"
              rel="stylesheet" />
        <script>
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            "primary": "#38e07b",
                            "background-dark": "#122017",
                            "surface-dark": "#1a2c22",
                            "border-dark": "#29382f",
                            "text-secondary": "#9eb7a8"
                        },
                        fontFamily: {
                            "display": ["Manrope", "sans-serif"],
                            "body": ["Noto Sans", "sans-serif"]
                        },
                    },
                },
            }
        </script>
    </head>
    <body class="bg-background-dark text-white font-display antialiased">
        <div class="flex h-screen w-full flex-col overflow-hidden">
            {% include 'partial/header.html' %}
            <div class="flex flex-1 overflow-hidden">
                <main class="flex-1 overflow-y-auto bg-[#0d1410]">
                    <div class="mx-auto max-w-7xl px-6 py-8 md:px-12 md:py-12">
                        <div class="flex items-center justify-between mb-10">
                            <div>
                                <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-2">My Properties</h1>
                                <p class="text-text-secondary text-lg">Manage your rental listings</p>
                            </div>
                            <a href="{% url 'add_house' %}"
                               class="bg-primary hover:bg-primary/90 text-background-dark rounded-lg px-6 py-3 font-bold text-sm transition-all shadow-lg shadow-primary/20 flex items-center gap-2">
                                <span class="material-symbols-outlined">add</span>
                                Add Property
                            </a>
                        </div>
                        {% if messages %}
                            <div class="mb-6 space-y-3">
                                {% for message in messages %}
                                    <div class="flex items-center gap-3 p-4 rounded-xl border {% if message.tags == 'success' %}bg-primary/10 border-primary{% elif message.tags == 'error' %}bg-red-500/10 border-red-500{% endif %}">
                                        <span class="material-symbols-outlined">
                                            {% if message.tags == 'success' %}
                                                check_circle
                                            {% else %}
                                                error
                                            {% endif %}
                                        </span>
                                        <p class="text-sm font-medium">{{ message }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                        {% if houses %}
                            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {% for house in houses %}
                                    <div class="bg-surface-dark rounded-xl border border-border-dark overflow-hidden hover:border-primary/50 transition-all group">
                                        <div class="relative aspect-video bg-gray-800">
                                            {% if house.main_image %}
                                                <a href="{% url 'house_detail' house.id %}">
                                                    <img src="{{ house.main_image.url }}"
                                                         alt="{{ house.label }}"
                                                         class="w-full h-full object-cover">
                                                </a>
                                            {% else %}
                                                <div class="w-full h-full flex items-center justify-center">
                                                    <span class="material-symbols-outlined text-6xl text-text-secondary">home</span>
                                                </div>
                                            {% endif %}
                                            <div class="absolute top-3 left-3 bg-{% if house.status == 'Available' %}primary{% elif house.status == 'Rented' %}blue-500{% else %}orange-500{% endif %} text-background-dark text-xs font-bold px-3 py-1 rounded-full">
                                                {{ house.status }}
                                            </div>
                                        </div>
                                        <div class="p-5">
                                            <h3 class="text-lg font-bold text-white mb-1 line-clamp-1">{{ house.label|default:house.type }}</h3>
                                            <p class="text-text-secondary text-sm mb-3 flex items-center gap-1">
                                                <span class="material-symbols-outlined text-base">pin_drop</span>
                                                {{ house.location.name }}, {{ house.location.cell.sector.district.city.name }}
                                            </p>
                                            <div class="flex items-center gap-4 mb-4 text-sm">
                                                <span class="flex items-center gap-1 text-text-secondary">
                                                    <span class="material-symbols-outlined text-base">bed</span>
                                                    {{ house.n_bed_rooms }}
                                                </span>
                                                <span class="flex items-center gap-1 text-text-secondary">
                                                    <span class="material-symbols-outlined text-base">bathtub</span>
                                                    {{ house.n_bath_rooms }}
                                                </span>
                                                <span class="flex items-center gap-1 text-text-secondary">
                                                    <span class="material-symbols-outlined text-base">square_foot</span>
                                                    {{ house.surface }}mÂ²
                                                </span>
                                                {% if house.has_wifi %}
                                                    <span class="flex items-center gap-1 text-text-secondary">
                                                        <span class="material-symbols-outlined text-text-secondary text-[18px]">wifi</span>
                                                    </span>
                                                {% endif %}
                                                {% if house.parkings %}
                                                    <span class="flex items-center gap-1 text-text-secondary">
                                                        <span class="material-symbols-outlined text-text-secondary text-[18px]">local_parking</span>
                                                        <span>{{ house.parkings }}</span>
                                                    </span>
                                                {% endif %}
                                            </div>
                                            <div class="mb-4">
                                                <p class="text-2xl font-bold text-primary">{{ house.monthly_rent|floatformat:0 }} FR</p>
                                                <p class="text-xs text-text-secondary">per month</p>
                                            </div>
                                            <!-- Actions -->
                                            <div class="flex gap-2">
                                                <a href="{% url 'edit_house' house.id %}"
                                                   class="flex-1 bg-border-dark hover:bg-primary/20 text-white hover:text-primary border border-transparent hover:border-primary/30 rounded-lg px-4 py-2 text-sm font-bold transition-all flex items-center justify-center gap-2">
                                                    <span class="material-symbols-outlined text-base">edit</span>
                                                    Edit
                                                </a>
                                                <button onclick="confirmDelete({{ house.id }}, '{{ house.label|default:house.type }}')"
                                                        class="flex-1 bg-red-500/10 hover:bg-red-500 text-red-400 hover:text-white border border-red-500/30 hover:border-red-500 rounded-lg px-4 py-2 text-sm font-bold transition-all flex items-center justify-center gap-2">
                                                    Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-20">
                                <span class="material-symbols-outlined text-6xl text-text-secondary mb-4 block">home_work</span>
                                <h3 class="text-xl font-bold text-white mb-2">No Properties Yet</h3>
                                <p class="text-text-secondary mb-6">Start by adding your first rental property</p>
                                <a href="{% url 'add_house' %}"
                                   class="inline-flex items-center gap-2 bg-primary hover:bg-primary/90 text-background-dark rounded-lg px-6 py-3 font-bold transition-all">
                                    <span class="material-symbols-outlined">add</span>
                                    Add Your First Property
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </main>
            </div>
        </div>
        <div id="deleteModal"
             class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-surface-dark border border-border-dark rounded-2xl max-w-md w-full p-6 transform scale-95 opacity-0 transition-all duration-200"
                 id="deleteModalContent">
                <div class="flex items-start gap-4 mb-4">
                    <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0">
                        <span class="material-symbols-outlined text-red-500 text-2xl">warning</span>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-white mb-1">Delete Property</h3>
                        <p class="text-text-secondary text-sm">
                            Are you sure you want to delete <span id="propertyName" class="text-white font-semibold"></span>? This action cannot be undone.
                        </p>
                    </div>
                </div>
                <form id="deleteForm" method="POST" class="flex gap-3 mt-6">
                    {% csrf_token %}
                    <button type="button"
                            onclick="closeDeleteModal()"
                            class="flex-1 bg-border-dark hover:bg-border-dark/80 text-white rounded-lg px-4 py-2.5 font-bold transition-all">
                        Cancel
                    </button>
                    <button type="submit"
                            class="flex-1 bg-red-500 hover:bg-red-600 text-white rounded-lg px-4 py-2.5 font-bold transition-all">
                        Delete
                    </button>
                </form>
            </div>
        </div>
        <script>
            function confirmDelete(houseId, houseName) {
                const modal = document.getElementById('deleteModal');
                const form = document.getElementById('deleteForm');
                const nameSpan = document.getElementById('propertyName');
                const content = document.getElementById('deleteModalContent');
                
                nameSpan.textContent = houseName;
                form.action = `/delete/${houseId}/`;
                
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            function closeDeleteModal() {
                const modal = document.getElementById('deleteModal');
                const content = document.getElementById('deleteModalContent');
                
                content.classList.add('scale-95', 'opacity-0');
                content.classList.remove('scale-100', 'opacity-100');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 200);
            }

        
            document.getElementById('deleteModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDeleteModal();
                }
            });

            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeDeleteModal();
                }
            });
        </script>
    </body>
</html>
